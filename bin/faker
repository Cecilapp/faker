#!/usr/bin/env php
<?php
/**
 * PHPoole is an easy and lightweight static website generator, written in PHP.
 * @see http://phpoole.org
 *
 * @author Arnaud Ligny <arnaud@ligny.org>
 * @license The MIT License (MIT)
 *
 * Copyright (c) Arnaud Ligny
 */
error_reporting(E_ALL ^ E_NOTICE);
date_default_timezone_set('UTC');

require_once 'vendor/autoload.php';

const CONTENT_DIR = './content/';
$dir = CONTENT_DIR;
$pages = 10;
$section = '';
$delete = false;

$options = getopt('help::', ['pages::', 'section::', 'delete::']);

//var_dump($options);
//var_dump($argv);
//die();

if ($argv[1] == 'help') {
	echo <<<EOT
Create fake pages.

Options:
`--pages`: number of pages, integer.
`--section`: section where to create pages, string.
`--delete`: force content directory deletion, boolean.
EOT;
exit(0);
}

if (isset($options['pages'])) {
	$pages = (int)$options['pages'];
}
if (isset($options['section'])) {
	$section = (string)$options['section'];
}
if (isset($options['delete']) && $options['delete'] === false) {
	$delete = true;
}

if (is_string($section)) {
 $dir .= $section;
}
if ($delete && is_dir($dir)) {
	printf("Deleting `%s` directory...\n", $dir);
	exec('rm -rf '.$dir);
}
printf("Creating `%s` directory...\n", $dir);
if (!@mkdir($dir, 0777, true)) {
	printf("`%s` directory exists...\n", $dir);
	exit(1);
}

$faker = Faker\Factory::create('fr_FR');

printf("Creating `%s` pages", $pages);
for ($i=0; $i < $pages; $i++) {
	$title = implode(' ', $faker->words(4));
	$date = $faker->date();
	$tags = '['.implode(', ', $faker->shuffle(array('un', 'deux', 'trois'))).']';
	$content = $faker->text(400);

	$data = '---'."\n"
		.'title: '.$title."\n"
		.'date: '.$date."\n"
		.'tags: '.$tags."\n"
		.'---'."\n"
		.$content."\n";

	file_put_contents(sprintf("%s/%s.md" , $dir, $title), $data);
	echo '.';
}

// time
printf("\nTime: %s seconds\n", round(microtime(true) - $_SERVER["REQUEST_TIME_FLOAT"], 2));
exit(0);
